<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniQuiz</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Rubik', sans-serif; }</style>
</head>
<body class="bg-blue-50 min-h-screen flex flex-col items-center justify-center p-4">

    <div id="login-screen" class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl text-center">
        <h1 class="text-3xl font-bold mb-6 text-blue-800">UniQuiz</h1>
        <input type="text" id="username" class="w-full p-4 border-2 border-gray-200 rounded-xl mb-4 text-right text-lg focus:border-blue-500 outline-none" placeholder="×”×©× ×©×œ×š...">
        <button onclick="joinGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold text-xl shadow-lg transition transform active:scale-95">×”×›× ×¡ ×œ××©×—×§ ğŸš€</button>
    </div>

    <div id="waiting-screen" class="hidden text-center w-full max-w-md">
        <div class="animate-bounce text-6xl mb-4">â³</div>
        <h2 class="text-2xl font-bold text-gray-700 animate-pulse" id="wait-msg">×××ª×™×Ÿ ×œ××¨×¦×”...</h2>
        <div class="mt-4 text-gray-500">××—×•×‘×¨ ×›: <span id="my-name-display" class="font-bold"></span></div>
    </div>

    <div id="game-screen" class="hidden w-full max-w-lg">
        <h2 id="question-text" class="text-2xl font-bold mb-8 text-center bg-white p-6 rounded-2xl shadow-md text-gray-800 border-b-4 border-blue-100"></h2>
        <div id="options-container" class="grid grid-cols-1 gap-4"></div>
    </div>

    <div id="result-screen" class="hidden text-center w-full max-w-md bg-white p-8 rounded-2xl shadow-xl">
        <div id="result-icon" class="text-6xl mb-4"></div>
        <h2 id="result-msg" class="text-3xl font-bold mb-2"></h2>
        <p class="text-gray-500 text-lg">×”× ×™×§×•×“ ×©×œ×š:</p>
        <p class="text-4xl font-black text-blue-600" id="score">0</p>
    </div>

    <script>
        const socket = io();
        let myId = "";

        socket.on('connect', () => {
            console.log("Connected to server:", socket.id);
            myId = socket.id;
        });

        function joinGame() {
            const input = document.getElementById('username');
            if (input.value.trim()) {
                const name = input.value;
                // ×©×œ×™×—×ª ×”×¤×§×•×“×” ×”× ×›×•× ×” 'join'
                socket.emit('join', name);
                document.getElementById('my-name-display').innerText = name;
                document.getElementById('login-screen').classList.add('hidden');
            }
        }

        socket.on('state_update', (state) => {
            console.log("State update received:", state);
            
            const me = state.players.find(p => p.id === myId);
            
            // × ×™×”×•×œ ××¡×›×™×
            if (document.getElementById('login-screen').classList.contains('hidden')) {
                document.getElementById('waiting-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.add('hidden');

                if (state.gameState === 'WAITING' || state.gameState === 'LEADERBOARD') {
                    document.getElementById('waiting-screen').classList.remove('hidden');
                    document.getElementById('wait-msg').innerText = "×××ª×™×Ÿ ×œ××¨×¦×”...";
                } 
                else if (state.gameState === 'QUESTION_ACTIVE') {
                    if (me && me.hasAnswered) {
                        document.getElementById('waiting-screen').classList.remove('hidden');
                        document.getElementById('wait-msg').innerText = "×ª×©×•×‘×” × ×§×œ×˜×”! ×××ª×™×Ÿ...";
                    } else {
                        renderQuestion(state.currentQuestion);
                    }
                } 
                else if (state.gameState === 'QUESTION_RESULT') {
                    document.getElementById('result-screen').classList.remove('hidden');
                    updateResultScreen(me);
                }
            }
        });

        function renderQuestion(q) {
            if (!q) return;
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('question-text').innerText = q.text;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            const colors = ['bg-red-500', 'bg-blue-500', 'bg-yellow-500', 'bg-green-500'];
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = `${colors[index % colors.length]} text-white p-6 rounded-xl shadow-md hover:opacity-90 transition font-bold text-xl text-right`;
                btn.innerText = opt;
                btn.onclick = () => socket.emit('submit_answer', index);
                container.appendChild(btn);
            });
        }

        function updateResultScreen(me) {
            const msg = document.getElementById('result-msg');
            const icon = document.getElementById('result-icon');
            const score = document.getElementById('score');
            
            if (me) {
                score.innerText = me.score;
                if (me.lastAnswerCorrect) {
                    msg.innerText = "× ×›×•×Ÿ ×××•×“!";
                    msg.className = "text-3xl font-bold mb-2 text-green-600";
                    icon.innerText = "ğŸ†";
                } else {
                    msg.innerText = "×œ× × ×•×¨×...";
                    msg.className = "text-3xl font-bold mb-2 text-red-600";
                    icon.innerText = "âŒ";
                }
            }
        }
    </script>
</body>
</html>
